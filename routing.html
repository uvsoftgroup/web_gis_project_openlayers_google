<!doctype html>
<html lang="en">
  <head>
    <title>Routing</title>
    <script src="http://openlayers.org/en/v3.0.0/build/ol.js" type="text/javascript"></script>
    <link rel="stylesheet" href="http://openlayers.org/en/v3.0.0/css/ol.css" type="text/css">
    <style>
      .map {
        height: 655px;
        width: 1257px;
      }	  
    </style> 
    <script type="text/javascript">
	function routing() {
      var map = new ol.Map({
        target: 'map',
        layers: [
          new ol.layer.Tile({
            source: new ol.source.MapQuest({layer: 'osm'})
          })
        ],
        view: new ol.View({
          center: ol.proj.transform([90.400558, 23.794455], 'EPSG:4326', 'EPSG:3857'),
          zoom: 13
        })
      });  
	  var params = {
			  LAYERS: 'pgrouting:pgrouting',
			  FORMAT: 'image/png'
			};	


			// The "start" and "destination" features.
			var startPoint = new ol.Feature();
			var destPoint = new ol.Feature();

			// The vector layer used to display the "start" and "destination" features.
			var vectorLayer = new ol.layer.Vector({
			  source: new ol.source.Vector({
				features: [startPoint, destPoint]
			  })
			});
			map.addLayer(vectorLayer);			
			
			
			
			// A transform function to convert coordinates from EPSG:3857
			// to EPSG:4326.
			var transform = ol.proj.getTransform('EPSG:3857', 'EPSG:4326');

			// Register a map click listener.
			map.on('click', function(event) {
			  if (startPoint.getGeometry() == null) {
				// First click.
				startPoint.setGeometry(new ol.geom.Point(event.coordinate));
			  } else if (destPoint.getGeometry() == null) {
				// Second click.
				destPoint.setGeometry(new ol.geom.Point(event.coordinate));
				// Transform the coordinates from the map projection (EPSG:3857)
				// to the server projection (EPSG:4326).
				var startCoord = transform(startPoint.getGeometry().getCoordinates());
				var destCoord = transform(destPoint.getGeometry().getCoordinates());
				var viewparams = [
				  'x1:' + startCoord[0], 'y1:' + startCoord[1],
				  'x2:' + destCoord[0], 'y2:' + destCoord[1]
				];
				params.viewparams = viewparams.join(';');
				result = new ol.layer.Image({
				  source: new ol.source.ImageWMS({
					url: 'http://localhost:8082/geoserver/pgrouting/wms',
					params: params
				  })
				});
				map.addLayer(result);
			  }
			});		
			
			var clearButton = document.getElementById('clear');
			clearButton.addEventListener('click', function(event) {
			  // Reset the "start" and "destination" features.
			  startPoint.setGeometry(null);
			  destPoint.setGeometry(null);
			  // Remove the result layer.
			  map.removeLayer(result);
			});
		}
	</script>	
  </head> 
  <body onload="routing();">
    <h3>Find shortest route<br></h3>
    <div id="map" class="map">
	<form action="file://C:/Users/riaydh/Desktop/Geomatics/Gematics_3/Open_Source_Gis/Scripting_Assignment/Website_Project/osMap.html">
    <button id="clear">clear</button>  
   </form> 
    </div>	
  </body>
</html>
